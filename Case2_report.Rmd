---
title: "Mitochondrial Efficiency: Oxygen Flux Trends by Transgenic Treatment Status"
author: "Olivia Fu, Christina Lee, Eunice Lee"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  bookdown::pdf_document2:
    latex_engine: xelatex
    toc: false
  bookdown::html_document2:
    toc: true
    number_sections: true
    fig_caption: true
editor: visual
---

# Background and Motivation

Researchers conducted a study to determine whether altering the genetic phenotype of mice influences mitochondrial function by measuring the metabolic efficiency under experimental conditions that varied in substrate type and energy demand. The aim was to compare activity levels between the control group (non-transgenic mice) and the treatment group (transgenic mice) using a multiplexed assay platform. To achieve this, our project goal was to build a modeling framework using the empirical data, implement a method for hypothesis testing to assess the genotype effect, and create a graphical summary to effectively highlight patterns or trends shown in the data. The analysis focused on oxygen consumption rate ($JO_2$) across different substrates and doses in order to better understand how genetic differences may influence mitochondrial efficiency.

# Data and Exploratory Analysis

The data for this analysis comes from skeletal muscle mitochondria isolated from mice. Our primary outcome variable is $JO_2$, the flux of oxygen, which reflects how much “work” mitochondria are capable of performing under given fuel and energy-demand conditions. We use $JO_2$ as an indicator of metabolic efficiency. The main explanatory variable of interest is genotype, comparing mitochondria from transgenic (`Tg`) mice to those from non-transgenic (`NT`) controls, to evaluate whether genetic modification alters metabolic and functional phenotypes in mice. Additional design factors include substrate type and $\Delta G_{ATP}$ (dose), the latter reflecting the energetic workload imposed by the creatine kinase energy clamp.

We began with an exploratory analysis of plotting raw values of $JO_2$ against $\Delta G_{ATP}$, faceted by substrate type (Figure 1). Within each panel, we subgrouped the data by genotype (`Tg` in teal, `NT` in red). We found that `Tg` mitochondria generally exhibited higher $JO_2$ than `NT` mitochondria, suggesting greater respiratory capacity. Higher energetic demand (less negative $\Delta G_{ATP}$) was associated with increased $JO_2$, though the magnitude of this effect varied by substrate. In addition, each subject’s measurements appeared to start from a different baseline, implying that random intercepts for subjects may be appropriate in the modeling framework.

To better visualize overall trends, we next plotted group means with standard errors by substrate, genotype, and dose (Figure 2). We initially observed nonlinear trends but when the $\Delta G_{ATP}=-12.95$ condition was excluded, as recommended in the study protocol, $JO_2$ increased approximately linearly with dose. Importantly, the effect of genotype varied by substrate. For `OcM` and `PcM`, the difference between `Tg` and `NT` remained relatively constant across doses, whereas for `GM`, `PM`, `PMOc`, and `PMPc`, the genotype effect widened at higher doses. These exploratory insights suggested that our model of $JO_2$ should include interaction terms among genotype, substrate, and dose, while also accounting for individual-level variability.

# Model Rationale, Implementation, and Evaluation

## Rationale & Selection

We chose to use a linear mixed-effects model to analyze $JO_2$, because the data structure and biological context both support this framework. Since our response variable of interest, flux of oxygen, is measured repeatedly across multiple substrate and workload conditions for each mouse, it results in correlated observations within the same subject. This violates the independence assumption of ordinary linear regression. A mixed model accounts for this correlation through the inclusion of a subject-specific random effect, allowing us to control for baseline differences across individuals.

Motivated by the study design and patterns observed in the exploratory analysis, we selected genotype, substrate, and dose ($\Delta G_{ATP}$ levels) as fixed effects for the model. Genotype is the primary explanatory variable of interest, and substrate type and dose are essential design factors that capture differences in metabolic pathway and energetic demand. The exploratory plot (Figure 2) revealed main effects of genotype and dose, as well as evidence that the genotype effect varies across substrates and becomes more pronounced at higher doses. These observations provide strong justification for including interaction terms among genotype, substrate, and dose.

To determine the random effects structure, we compared a model with subject-level random effects to one with pair-level random effects. While each mouse subject may have a distinct baseline, paired subjects could share correlation because their measurements were conducted together. As shown in Table 1, the subject-level random effect model provided a better fit, with lower AIC and BIC values. We also evaluated the inclusion of interaction terms by comparing a model with only two-way interactions to a full model with all three-way interactions. According to Table 2, the full three-way interaction model again yielded lower AIC and BIC values.

For $i$ = observation, $j$ = subject, our final model equation is as follows, where `Substrate` is a vector of 6 levels:

$$
\begin{aligned}
JO2_{ij} = \beta_0 &+ \beta_1 Group_i + \beta_2 Dose_i + \beta_3^{\top} Substrate_i \\
&+ \beta_4 (Group_i*Dose_i) + \beta_5^{\top} (Group_i*Substrate_i) + \beta_6^{\top} (Dose_i*Substrate_i) \\
&+ \beta_7^{\top} (Group_i*Dose_i*Substrate_i) + u_j + \varepsilon_{ij}
\end{aligned}
$$

The full listing of numerical values for each $\beta$ coefficient of our final model can be found in Table 5. We modeled our random effects and residual error terms as normal distributions following the Central Limit Theorem, as robustness to non-normality is a strength of linear mixed effects models.

$$
\begin{aligned}
& u_j \sim N(0, \sigma^2_{\text{Subject}}) \\
& \varepsilon_{ij} \sim N(0, \sigma^2)
\end{aligned}
$$

## Implementation

Before model fitting, we cleaned the dataset by excluding the `Basal` condition and the `−12.95` dose level, as these are not typically included in the analysis. We also removing observations with missing values. Doses were treated as a continuous numeric variable, as the given values were not equally spaced apart.

The model was fit in R using the `lmer()` function from the `lme4` package, with full three-way interaction terms for genotype, substrate, and dose (`group*substrate*dose`) and a random intercept for subject (`1 | Subject`). This specification accounts for within-subject correlation and baseline variability.

## Evaluation

To evaluate whether the model provided a good fit for the data, we examined multiple residual plots. The Q–Q plots for both residuals and random effects (Figure 4) showed that most points lay close to the diagonal line, with only a few outliers present at the tails. This supports the normality assumption for our model. Furthermore, The residuals vs. fitted values plot (Figure 5) showed that the points were randomly scattered around the zero line, which supports the constant variance assumption since there were no clear clustering or patterns present. To add on, the residuals plotted by group and substrate (Figure 6) showed no strong deviations, which suggested independence across these factors for our data. However, the residuals plotted by dose (Figure 6) displayed a slight curvature, which may indicate potential nonlinearity in that variable.

We also computed the $R^2$ values for our model. The marginal $R^2$ (fixed-effect only) was 0.90, and the conditional $R^2$ (fixed + random effects) was 0.97 (Table 3). This means genotype, substrate, dose, and their interactions explained approximately 90% of the variation in $JO_2$. When the random effects were also included, this explained 97% of the variation. Such high $R^2$ values support that our model is a good fit for the data. Overall, these diagnostics suggest that our model fits the data well and generally satisfies the regression assumptions.

# Results

## **(1) Model formulation and fitting**

We modeled mitochondrial oxygen consumption rate $JO_2$ as a function of genotype, substrate, and dose, while accounting for subject-level heterogeneity using a mixed-effects model. This framework allowed us to evaluate both baseline differences and dose–response trends between genotypes, conditional on substrate type.

## **(2) Genetic associations with mitochondrial efficiency**

To evaluate the overall genetic effect, we first conducted a likelihood-ratio test comparing the full model with a reduced model that excluded all genotype terms (Table 4). The lower AIC and BIC values, together with the significant test statistic, indicated that genotype contributes significantly to variation in oxygen flux.

Following this, we examined the fixed-effect coefficients in the final model (Table 5). While the intercept value should be interpreted with caution as it represents an extrapolation at dose=0, we found that `Tg` group had a higher overall level of oxygen flux than `NT` (estimate = 22,297; p = 0.001) through this term. Moreover, the genotype–dose interaction (estimate = 1,514; p = 0.001) showed that `Tg` exhibited a significantly steeper positive slope than `NT`, indicating that genetic effects on mitochondrial efficiency increased with dose. Hence, `Tg` groups overall demonstrated higher mitochondrial efficiency than `NT` groups, and this difference was amplified at higher dose levels.

We next assessed whether genetic effects varied across substrates using estimated marginal means (package: `emmeans`) derived from our final mixed-effects model. Pairwise contrasts between groups (`Tg − NT`) were evaluated with t-tests based on the model’s fixed effects. Slope differences between treatment groups were significant only for `GM`, `PMOc`, and `PMPc` substrates, where `Tg` exhibited steeper positive slopes than `NT` for all (Table 6). This was consistent with the visualization, in which slope differences appeared more subtle for `OcM`, `PcM`, and `PM` (Figure 3). In contrast, `OcM` and `PcM` showed significantly different baseline levels despite having similar slopes, as indicated in Table 7 and reflected by the consistently higher $JO_2$​ values for `Tg` running nearly parallel to `NT`. These results suggest that genetic effects depend on substrate, expressed either as greater changes in slope for some substrates or as higher baseline levels for others. No significant genotype dependence was detected for `PM`.

## (3) Graphical summary of associations

To visually summarize these associations, we plotted regression lines for `Tg` and `NT` groups across dose levels, faceted by substrate (Figure 3). This graphical summary highlights the key patterns of genetic association, enabling a straightforward comparison of slope differences and baseline offsets across substrates. The plot effectively complements the statistical results by illustrating how genetic effects on mitochondrial efficiency manifest differently depending on substrate and dose.

# Limitations and Conclusion

Based on our analysis, due to the potential non-linearity shown in the residual graph for dose (Figure 6), we believe that applying a log transformation or adding higher-order terms in future work might help improve the model results. Since the group and substrate variables did not show any limitations with respect to the independence assumption, evaluating and improving the dose variable is a priority. Additionally, to address the few outliers present in the residuals and the random-effects QQ plot (Figure 4), taking a closer look at the data to evaluate these regions is important in case of potential data entry errors or biological principles behind the skewed points. A transformation of the model and examining other diagnostics, including Cook’s distance or leverage, can serve as next steps to account for the normality assumption. Furthermore, because there could be potential confounding effects from `dPsi`, `Redox`, `e-1 leak`, `auranofin`, and `cdnb`, it would be beneficial to check for correlations between these variables and $JO_2$​, dose, and substrate in greater detail. Obtaining access to data with these measures, rather than relying solely on the provided plots, would support a more thorough evaluation.

According to our modeling, hypothesis testing, and evaluation, the level of $JO_2$​ is influenced by genotype, substrate, and dose. Overall, the transgenic group exhibited higher oxygen flux levels and steeper slopes, indicating greater mitochondrial efficiency compared with the non-transgenic group. Furthermore, hypothesis testing showed that the genetic association with mitochondrial efficiency depends on both substrate and dose. For `GM`, `PMOc`, and `PMPc` substrates, the transgenic group demonstrated significantly steeper slopes than the non-transgenic group, indicating a greater increase in $JO_2$​​ as dose increased. For `OcM` and `PcM` substrates, genetic effects were reflected instead in significant baseline shifts, with consistently higher $JO_2$​ values for the transgenic group across doses despite similar slopes. These findings provide strong statistical evidence that genotype plays a central role in shaping mitochondrial phenotype, with effects that vary according to substrate type and dose level.

\pagebreak

# Appendix

```{r include=FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(readr)
library(lme4)
library(kableExtra)
library(patchwork)
library(MuMIn)
library(lmerTest)
library(emmeans)

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r load-data}
data <- read_csv("JO2.csv", col_names = FALSE, show_col_types = FALSE)
```

```{r clean-data}
# extract substrate and dose
substrate  <- as.character(data[1, ])
dose  <- as.character(data[2, ])

# fill in substrate for each column
substrate <- trimws(sub("\\s*\\(.*\\)$", "", substrate))
substrate <- na_if(substrate, "")
substrate <- na_if(substrate, "NA")
substrate <- fill(tibble(Substrate = substrate),
                         Substrate, .direction = "down")$Substrate

# build new column names
new_names <- ifelse(tolower(dose) == "subject", "Subject",
                    paste0(substrate, ".", dose))
data <- data[-c(1,2), ]
names(data) <- make.unique(new_names, sep = "_")

# solve type issue
val_cols <- setdiff(names(data), "Subject")
data[val_cols] <- lapply(data[val_cols], function(x) {
  if (is.character(x)) parse_number(x) else as.numeric(x)
})

# make the longer table
data_cleaned <- data |>
  pivot_longer(
    cols = -Subject,
    names_to     = c("substrate", "dose"),
    names_pattern = "^([^.]+)\\.(.+)$",       # split once at first dot
    values_to    = "Value"
) |>
  mutate(
    group = ifelse(grepl("^NT", Subject, ignore.case=TRUE), "NT", "Tg")
  )
```

```{r}
data_plot <- data_cleaned |>
  # don't include basal in the plot
  filter(dose != "Basal") |>
  # treat dose as continuous numeric values
  mutate(dose = as.numeric(dose))
```

```{r fig-1, fig.cap="Scatterplots of $J O_{2}$ versus $\\Delta G_{ATP}$, faceted by substrate type and separated by genotype (Tg in teal, NT in red). Each point represents an individual observation. The plots illustrate generally higher $J O_{2}$ in Tg mitochondria, increasing trends with dose, and variability in baseline metabolic activity across subjects.", warning=FALSE}

ggplot(data_plot, aes(dose, Value,
                      group = interaction(Subject, substrate),
                      color = group)) +
  geom_line(alpha = 0.35) +
  geom_point(alpha = 0.7, size = 1.8) +
  facet_wrap(~ substrate) +
  labs(
    x = expression(Delta*G[ATP]), 
    y = expression(JO2),
    title = "Raw JO2 measurements across dose levels by subject and substrate") +
  scale_x_continuous(
    breaks = c(-14.49, -14.36, -14.19, -13.95, -13.65, -12.95)
  ) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r fig-2, fig.cap="Mean $J O_{2}$ with standard errors plotted against $\\Delta G_{ATP}$, grouped by substrate and genotype. Excluding the $-12.95\\, \\Delta G_{ATP}$ condition, the relationship between $J O_{2}$ and workload appears approximately linear. Genotype effects are consistent for OcM and PcM, while they become more pronounced at higher workloads for GM, PM, PMOc, and PMPc.", warning=FALSE, message=FALSE}

# calculate mean and se for each group
sum_df <- data_plot |>
  group_by(substrate, group, dose) |>
  summarise(mean = mean(Value, na.rm = TRUE),
            se   = sd(Value, na.rm = TRUE) / sqrt(sum(!is.na(Value))),
            .groups = "drop")

ggplot(sum_df, aes(dose, mean, color = group, group = group)) +
  geom_line() +
  geom_point() +
  geom_errorbar(aes(ymin = mean - se, 
                    ymax = mean + se), 
                width = 0.12) +
  facet_wrap(~ substrate) +
  labs(x = expression(Delta*G[ATP]),
       y = "JO2 (mean ± SE)",
       title = "Mean JO2 ± SE across dose levels by genotype and substrate") +
  scale_x_continuous(
    breaks = c(-14.49, -14.36, -14.19, -13.95, -13.65, -12.95)
  ) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
data_model <- data_cleaned |>
  # exclude Basal and -12.95 for modeling
  filter(dose != "Basal", dose != "-12.95") |>
  # treat dose as numeric, others as factor
  mutate(substrate = factor(substrate),
         dose = as.numeric(dose),
         Subject = factor(Subject),
         Pair = factor(parse_number(as.character(Subject)))) |>
  drop_na()
```

```{r}
# our final model
lmm_full_subject <- lmer(
  Value ~ group * substrate * dose +
        (1 | Subject),
  data = data_model, REML = TRUE
)
```

```{r message=FALSE}
# compare with pair random effect
lmm_full_pair <- lmer(
  Value ~ group * substrate * dose +
          (1 | Pair), 
  data = data_model, REML = TRUE
)

comp_random <- anova(lmm_full_pair, lmm_full_subject)

kable(comp_random, 
      digits = 3, 
      caption = "Model comparison between pair and subject random effects") |>
  kable_styling(latex_options = "HOLD_position")
```

```{r message=FALSE}
# compare with 2-way interaction terms
lmm_2ways_subject <- lmer(
  Value ~ group * substrate + group * dose + substrate * dose +
          (1 | Subject),
  data = data_model, REML = TRUE
)

comp_fix <- anova(lmm_2ways_subject, lmm_full_subject)

kable(comp_fix, 
      digits = 3, 
      caption = "Model comparison between two-way interaction terms and full three-way interactions") |>
  kable_styling(latex_options = "HOLD_position")
```

```{r fig-3, fig.cap="Model-predicted oxygen flux ($J O_{2}$) as a function of dose, stratified by substrate and genotype. Points represent observed data, while lines show fitted values from the mixed-effects model. The plot highlights differences in baseline levels and slopes between Tg and NT groups across substrates."}
# sequence of doses for smooth fitted curves
dose_seq <- seq(min(data_model$dose),
                max(data_model$dose),
                length.out = 100)

# build grid for predictions
newdat <- expand_grid(
  dose      = dose_seq,
  substrate = unique(data_model$substrate),
  group     = unique(data_model$group)
)

# predict fitted values (fixed effects only)
newdat$pred <- predict(lmm_full_subject,
                       newdata = newdat,
                       re.form = NA)

# plot: raw data as points, fitted as smooth lines
ggplot() +
  geom_point(data = data_model,
             aes(x = dose, y = Value, color = group),
             alpha = 0.5, size = 2) +
  geom_line(data = newdat,
            aes(x = dose, y = pred, color = group),
            size = 1.2) +
  facet_wrap(~ substrate, scales = "free_y") +
  labs(x = expression(Delta*G[ATP]),
       y = "JO2",
       title = "Model-predicted JO2 responses by genotype and substrate") +
  theme_bw() +
  scale_x_continuous(
    breaks = c(-14.49, -14.36, -14.19, -13.95, -13.65, -12.95)
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r fig-4, fig.cap="Shows Q-Q plots of residuals and random effects based on the model. Most data points follow the red diagonal line, supporting normality. There are a few outliers present near the tail ends."}
# Plot residuals and random effects side by side
par(mfrow = c(1, 2), las = 1)

# Residuals Q-Q plot
qqnorm(residuals(lmm_full_subject), main = "Residuals")
qqline(residuals(lmm_full_subject), col = "red")

# Random effects Q-Q plot (Subjects)
qqnorm(unlist(ranef(lmm_full_subject)$Subject), main = "Random Effects")
qqline(unlist(ranef(lmm_full_subject)$Subject), col = "red")
```

```{r fig-5, fig.cap="Shows the Residual vs. Fitted Values. Points are randomly spread out about the zero line, which supports the constant variance assumption."}
# Extract residuals and fitted values
resid_vals <- resid(lmm_full_subject)
fitted_vals <- fitted(lmm_full_subject)

# Residuals vs Fitted plot
p1 <- ggplot(data.frame(Fitted = fitted_vals, Residuals = resid_vals), 
             aes(x = Fitted, y = Residuals)) +
  geom_point(alpha = 0.6) +
  geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
  theme_minimal() +
  labs(title = "Residuals vs Fitted", x = "Fitted values", y = "Residuals")

p1
```

```{r fig-6, fig.cap="Shows box plots for Group and Substrate variables, and scatterplot for Dose variable. Slight curvature shown in Residuals by Dose, which affects independence assumption.", message=FALSE}
# Extract residuals
resid_vals <- resid(lmm_full_subject)

# Add residuals to dataset
data_resid <- data_model
data_resid$Residuals <- resid_vals

# Residuals vs group (categorical)
p1 <- ggplot(data_resid, aes(x = group, y = Residuals)) +
  geom_boxplot(outlier.colour = "red", alpha = 0.6) +
  theme_minimal() +
  labs(title = "Residuals by Group")

# Residuals vs substrate (categorical)
p2 <- ggplot(data_resid, aes(x = substrate, y = Residuals)) +
  geom_boxplot(outlier.colour = "red", alpha = 0.6) +
  theme_minimal() +
  labs(title = "Residuals by Substrate")

# Residuals vs dose (continuous or factor?)
# If continuous:
p3 <- ggplot(data_resid, aes(x = dose, y = Residuals)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "loess", se = FALSE, color = "blue") +
  theme_minimal() +
  labs(title = "Residuals by Dose")

p1 + p2 + p3
```

```{r}
# r squared calculation
r2_values <- r.squaredGLMM(lmm_full_subject)

# R2m = marginal R² (fixed effects)
# R2c = conditional R² (fixed + random effects)

kable(r2_values, 
      digits = 3, 
      caption = "Marginal and conditional $R^2$ for the final mixed-effects model.") |>
  kable_styling(latex_options = "HOLD_position")
```

```{r message=FALSE}
# Remove ALL genotype terms (main + interactions)
lmm_noG <- update(lmm_full_subject, . ~ . - group - group:substrate - group:dose - group:substrate:dose)
comp_nog <- anova(lmm_noG, lmm_full_subject)

kable(comp_nog, 
      digits = 3, 
      caption = "Model comparison of the full model versus the reduced model without genotype terms (main and interaction effects).") |>
  kable_styling(latex_options = "HOLD_position")
```

```{r message=FALSE}
kable(as.data.frame(coef(summary(lmm_full_subject))), 
      digits = 3,
      caption = "Fixed-effect coefficients from the final mixed-effects model") |>
  kable_styling(latex_options = "HOLD_position")
```

```{r}
# Estimate slopes of dose effect for each group × substrate
slopes <- emtrends(lmm_full_subject, ~ group | substrate, var = "dose")

# Contrast slopes between groups (Tg − NT)
slope_diff <- contrast(slopes, "revpairwise")

# Summarize with inference
slope_summary <- summary(slope_diff, infer = TRUE)

kable(slope_summary, digits = 3,
      caption = "Differences in dose–response slopes (Tg − NT) within each substrate, estimated from the final mixed-effects model.") |>
  kable_styling(latex_options = "HOLD_position")
```

```{r}
low <- min(data_model$dose)

# EMMs for group, conditioned on substrate × dose (only lowest dose)
emm_sd_low <- emmeans(
  lmm_full_subject,
  ~ group | substrate * dose,
  at = list(dose = low),
  weights = "equal"
)

# Tg − NT contrasts within each substrate
contr_low <- contrast(
  emm_sd_low,
  method = "revpairwise",
  by = c("substrate", "dose")
)

contr_summary_low <- summary(contr_low, infer = TRUE)

kable(contr_summary_low, digits = 3,
      caption = "Differences between Tg and NT within each substrate at the lowest dose, estimated from the final mixed-effects model.") |>
  kable_styling(latex_options = "HOLD_position")
```
